function renderComp(a,n){const i=apiNameAndIcon(a.items.mainItems),e=apiNameAndIcon(a.augments.mainAugs),s=Object.fromEntries(a.champions.mainChampions.map((a=>[a.apiName,[a.icon,a.cost,a.name,a.traits]])));tierList(n.guides,s,i,e);const t=document.querySelector(".tier-comp-container");function o(a){const t=a.target.closest(".hexagon-tier-champ a");if(!t)return;a.preventDefault();const o=t.hash.substring(1),c=t.getAttribute("data-index"),r=t.closest(".comp-list").nextElementSibling,d=t.closest(".tier-container");if(o===window.location.hash.substring(1))return d.classList.toggle("hide-post-comp"),t.classList.toggle("active"),void history.pushState(null,"",d.classList.contains("hide-post-comp")?window.location.pathname:`#${o}`);const m=document.querySelectorAll(".tier-container"),l=document.querySelectorAll(".hexagon-tier-champ a");m.forEach((a=>a.classList.add("hide-post-comp"))),l.forEach((a=>a.classList.remove("active"))),d.classList.remove("hide-post-comp"),t.classList.add("active"),renderPostComp(n.guides[c],s,i,e,r),requestAnimationFrame((()=>{scrollToPost(d,r)})),history.pushState(null,"",`#${o}`)}t&&(t.removeEventListener("click",o),t.addEventListener("click",o))}function scrollToPost(a,n){const i=a.getBoundingClientRect(),e=n.getBoundingClientRect(),s=window.innerHeight,t=window.pageYOffset+i.top-60;(e.bottom>s||i.top<60)&&window.scrollTo({top:t,behavior:"smooth"})}function tierList(a,n,i,e){const s=document.querySelector(".tier-comp-container");if(!s)return;const t=a.reduce(((a,{mainChampion:s,mainItem:t,mainAugment:o,tier:c,title:r},d)=>{if(!n[s.apiName])return a;const m=convertURL(n[s.apiName][0]),l=`\n    <div class="tier-list cost-${n[s.apiName][1]}">\n      <div class="hexagon-tier-champ">\n        <a href="${toHashtag(r)}" style="background-image: url(${m})" title="${r}" data-index="${d}"></a>\n      </div>\n      ${t&&i[t.apiName]?`<div class="hexagon-item"> \n        <div class="hexagon-icon" style="background-image: url(${convertURL(i[t.apiName])})" data-api-name="${t.apiName}"></div>\n      </div>`:""}\n      ${o&&e[o.apiName]?`<div class="hexagon-item"> \n        <div class="hexagon-icon" style="background-image: url(${convertURL(e[o.apiName])})" data-api-name="${o.apiName}"></div>\n      </div>`:""}\n    </div>\n    `;switch(c){case"S":a.groupS+=l;break;case"A":a.groupA+=l;break;case"B":a.groupB+=l;break;case"C":a.groupC+=l;break;case"X":a.groupX+=l;break}return a}),{groupS:"",groupA:"",groupB:"",groupC:"",groupX:""});function o(a,n){return`\n    <div class="tier-container comp-tier-${a}">\n      <div class="comp-list">\n        <div class="tier-title">\n          <img src="https://cdn.jsdelivr.net/gh/hoangdieu606/tft@main/images/${a}-Tier.webp">\n          <img src="https://cdn.jsdelivr.net/gh/hoangdieu606/tft@main/images/${a}-Tier-Wide.webp">\n          <img src="https://cdn.jsdelivr.net/gh/hoangdieu606/tft@main/images/${a}-Tier-Texture.webp">\n        </div>\n        <div class="tier-group">${n}</div>\n      </div>\n      <div class="post-comp"></div>\n    </div>`}s.innerHTML=o("S",t.groupS)+o("A",t.groupA)+o("B",t.groupB)+o("C",t.groupC)+o("X",t.groupX)}function renderPostComp(a,n,i,e,s){if(!s||!a)return;const{mainChampion:t,mainItem:o,mainAugment:c,tier:r,title:d,style:m,augments:l,augmentTypes:p,augmentsTip:v,finalComp:g,earlyComp:h,carousel:u,tips:f,altBuilds:$}=a,L={ECON:"Kinh Tế","ECON-URL":"https://cdn.jsdelivr.net/gh/hoangdieu606/tft@main/images/econ.png",EMBLEM:"Ấn","EMBLEM-URL":"https://cdn.jsdelivr.net/gh/hoangdieu606/tft@main/images/emblem.png",ITEMS:"Trang Bị","ITEMS-URL":"https://cdn.jsdelivr.net/gh/hoangdieu606/tft@main/images/item.png",COMBAT:"Combat","COMBAT-URL":"https://cdn.jsdelivr.net/gh/hoangdieu606/tft@main/images/combat.png",HERO:"Anh hùng","HERO-URL":"https://cdn.jsdelivr.net/gh/hoangdieu606/tft@main/images/hero.png"},x=[];if(!n[t.apiName])return void(s.innerHTML='<div class="error">Không tìm thấy dữ liệu tướng</div>');const w=g.map((({apiName:a,items:e,stars:s})=>{if(!n[a])return"";n[a][3]&&x.push(...n[a][3]);let t="";3===s?t='<div class="star-champ three-stars"><span><i class="fa-solid fa-star"></i></span><span><i class="fa-solid fa-star"></i></span><span><i class="fa-solid fa-star"></i></span></div>':4===s&&(t='<div class="star-champ four-stars"><span><i class="fa-solid fa-star"></i></span><span><i class="fa-solid fa-star"></i></span><span><i class="fa-solid fa-star"></i></span><span><i class="fa-solid fa-star"></i></span></div>');const o=(e||[]).map((a=>(a.includes("Emblem")&&x.push({apiName:"Emblem"}),`<span><img src="${convertURL(i[a])}" width="24" height="24" data-api-name="${a}"></span>`))).join("");return`\n      <div class="hexagon-icon champ-cost-${n[a][1]}">\n        ${t}\n        <div class="hexagon-champ">\n          <img src="${convertURL(n[a][0])}" width="80" height="80" data-api-name="${a}">\n        </div>\n        <div class="hexagon-items">\n          ${o}\n        </div>\n        <div class="hexagon-name">${n[a][2]}</div>\n      </div>\n    `})).join(""),y=processTraits(x);s.innerHTML=`\n    <div class="row-comp row-1-comp comp-tier-${r}">\n      <div class="left-one">\n        <div class="comp-shadow"></div>\n        <div class="comp-main-champ">\n          <div class="comp-champ-tier">${r}</div>\n          <div class="comp-champ-icon">\n            <div style="background-image: url(${convertURL(n[t.apiName][0])})" data-api-name="${t.apiName}"></div>\n          </div>\n          ${o&&i[o.apiName]?`<div class="comp-champ-trait"><img src="${convertURL(i[o.apiName])}" data-api-name="${o.apiName}"></div>`:""}\n          ${c&&e[c.apiName]?`<div class="comp-champ-trait"><img src="${convertURL(e[c.apiName])}" data-api-name="${c.apiName}"></div>`:""}\n        </div>\n        <div class="comp-title">\n          ${d}\n        </div>\n        <div class="comp-style">\n          Phong Cách: ${m}\n        </div>\n        <div class="comp-traits">\n          ${y.map((({apiName:a,icon:n,maxTraits:i})=>`<div data-api-name="${a}"><img src="${convertURL(n)}"><span>${i}</span></div>`)).join("")}\n        </div>\n      </div>\n      <div class="right-one">\n        <button class="comp-close"><i class="fa-solid fa-xmark"></i></button>\n        <div class="comp-augs-list">\n          <div class="title-comp">Những Lõi Mạnh</div>\n          <div>${l.map((({apiName:a})=>e[a]?`<img src="${convertURL(e[a])}" data-api-name="${a}">`:"")).join("")}</div>\n        </div>\n        <div class="comp-augs-priority">\n          <div class="title-comp">Ưu tiên lõi</div>\n          <div>${p.map((a=>`<div class="priority-icon"><img src="${L[`${a}-URL`]}"><span>${L[a]}</span></div><svg width="9" height="13" viewBox="0 0 149 213" fill="none">\n            <path d="M137.225 81.825L55.625 8.625C34.325-10.475.525 4.625.525 33.225v146.3c0 28.6 33.8 43.7 55.1 24.6l81.6-73.2c14.6-13.1 14.6-36.1 0-49.2z" fill="#FFC808"/>\n             </svg>`)).join("")}</div>\n        </div>\n        <div class="comp-tip">\n          <span>Mẹo</span>\n          <p>${v}</p>\n        </div>\n      </div>\n    </div>\n    <div class="row-comp">\n      <div class="title-comp">Đội hình hoàn thiện</div>\n      <div class="final-comp">\n        ${w}\n      </div>    \n    </div>\n    <div class="row-comp">\n      <div class="title-comp">Đội hình đầu trận</div>\n      <div class="early-comp">\n        ${h.map((({apiName:a,items:e})=>n[a]?`\n            <div class="hexagon-icon champ-cost-${n[a][1]}">\n              <div class="hexagon-champ">\n                <img src="${convertURL(n[a][0])}" width="58" height="58" data-api-name="${a}">\n              </div>\n              <div class="hexagon-items">\n                ${e?e.map((a=>`<span><img src="${convertURL(i[a])}" width="20" height="20" data-api-name="${a}"></span>`)).join(""):""}\n              </div>\n              <div class="hexagon-name">${n[a][2]}</div>\n            </div>\n          `:"")).join("")}\n      </div>\n    </div>\n    <div class="row-comp">\n      <div class="title-comp">Ưu tiên mảnh trang bị</div>\n      <div class="item-priority">\n        ${u.map((({apiName:a})=>i[a]?`\n            <div class="hexagon-icon">\n              <div class="hexagon-champ">\n                <img src="${convertURL(i[a])}" width="58" height="58" data-api-name="${a}">\n              </div>\n            </div>\n          `:"")).join("")}\n      </div>\n    </div>\n    <div class="row-comp">\n      <div class="title-comp">Tạo tác nếu có</div>\n      <div class="alt-comp">\n        ${$.map((({apiName:a,items:e})=>n[a]?`\n            <div class="hexagon-icon champ-cost-${n[a][1]}">\n              <div class="hexagon-champ">\n                <img src="${convertURL(n[a][0])}" width="80" height="80" data-api-name="${a}">\n              </div>\n              <div class="hexagon-items">\n                ${e?e.map((a=>`<span><img src="${convertURL(i[a])}" width="24" height="24" data-api-name="${a}"></span>`)).join(""):""}\n              </div>\n              <div class="hexagon-name">${n[a][2]}</div>\n            </div>\n          `:"")).join("")}\n      </div>\n    </div>\n    <div class="row-comp">\n      <div class="toggle-container">\n        <span class="toggle-label">Hiện Tên</span>\n        <div class="toggle"></div>\n      </div>\n      <div class="title-comp">Hướng dẫn xếp tướng</div>\n      <div class="position-comp"></div>\n    </div>\n    <div class="row-comp">\n      <div class="title-comp">Tips các giai đoạn</div>\n      <div class="end-comp">\n        ${f.map((({stage:a,tip:n})=>`<div class="tip-end-comp"><span>${a}</span><span>${n}</span></div>`)).join("")}\n      </div>\n    </div>\n  `,createBoard(g,n,i,s);const N=s.querySelector("button.comp-close");N&&(N.onclick=()=>{const a=s.closest(".tier-container");a.querySelector(".hexagon-tier-champ a.active")?.classList.remove("active"),a.classList.add("hide-post-comp"),history.pushState(null,"",window.location.pathname)}),setupToggle(s),setupTooltips()}function createBoard(a,n,i,e){const s=e.querySelector(".position-comp");if(!s)return;s.innerHTML="";const t=document.createDocumentFragment();for(let a=0;a<4;a++){const n=document.createElement("div");n.className="row";for(let i=0;i<7;i++){const e=document.createElement("div");e.className="hexagon",e.dataset.index=7*a+i,n.appendChild(e)}t.appendChild(n)}s.appendChild(t),placeChampions(a,n,i,s)}function placeChampions(a,n,i,e){if(!e||!a)return;document.createDocumentFragment();const s=Array.from(e.querySelectorAll(".hexagon"));a.forEach((({apiName:a,boardIndex:e,items:t,stars:o})=>{if(!a||!n[a])return;const c=s.find((a=>a.dataset.index===e.toString()));if(!c)return;const r=t?t.map((a=>i[a]?`<span><img src="${convertURL(i[a])}" width="24" height="24" data-api-name="${a}"></span>`:"")).join(""):"";c.className="hexagon has-champ",c.innerHTML=`\n      <div class="hexagon-icon champ-cost-${n[a][1]}">\n        ${3===o?'<div class="star-champ three-stars"><span><i class="fa-solid fa-star"></i></span><span><i class="fa-solid fa-star"></i></span><span><i class="fa-solid fa-star"></i></span></div>':""}\n        ${4===o?'<div class="star-champ four-stars"><span><i class="fa-solid fa-star"></i></span><span><i class="fa-solid fa-star"></i></span><span><i class="fa-solid fa-star"></i></span><span><i class="fa-solid fa-star"></i></span></div>':""}\n        <div class="hexagon-champ">\n          <img src="${convertURL(n[a][0])}" data-api-name="${a}">\n        </div>\n        <div class="hexagon-items">\n          ${r}\n        </div>\n        <div class="hexagon-name">${n[a][2]}</div>\n      </div>\n    `}))}function processTraits(a){if(!Array.isArray(a)||0===a.length)return[];const n={},i={};a.forEach((a=>{if(!a)return;const e=a.apiName;"Emblem"!==e&&(i[e]=(i[e]||0)+1,n[e]||(n[e]={apiName:a.apiName,name:a.name,icon:a.icon,minUnits:a.minUnits}))}));const e=a.filter((a=>a&&"Emblem"===a.apiName)).length;if(e>0){let a=0,n=null;for(const e in i)i[e]>a&&(a=i[e],n=e);n&&(i[n]+=e)}return Object.keys(n).map((a=>({...n[a],maxTraits:i[a]}))).filter((a=>a.maxTraits>=a.minUnits)).sort(((a,n)=>n.maxTraits-a.maxTraits))}function setupToggle(a){const n=a.querySelector(".toggle-container");if(!n)return;const i=n.querySelector(".toggle"),e=n.querySelector(".toggle-label");if(!i||!e)return;const s=document.body,t=document.documentElement;const o="flex"===localStorage.getItem("nameDisplay");var c;c=o,s.classList.toggle("name-active",c),t.style.setProperty("--name-display",c?"flex":"none"),e.textContent=c?"Ẩn Tên":"Hiện Tên",i.addEventListener("click",(function(){const a=s.classList.toggle("name-active");t.style.setProperty("--name-display",a?"flex":"none"),e.textContent=a?"Ẩn Tên":"Hiện Tên",localStorage.setItem("nameDisplay",a?"flex":"none")}))}function toHashtag(a){return a?"#"+a.normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase().replace(/đ/g,"d").replace(/[^a-z0-9\s-]/g,"").trim().replace(/\s+/g,"-"):"#"}function handleHashURL(a,n){if(!a||!n||!n.guides)return;const i=window.location.hash;if(!i)return void history.replaceState(null,"",window.location.pathname+window.location.search);const e=document.querySelector(`.hexagon-tier-champ a[href="${i}"]`);if(!e)return;const s=e.getAttribute("data-index");if(!n.guides[s])return;const t=e.closest(".tier-container"),o=t.querySelector(".post-comp");if(!o)return;document.querySelectorAll(".tier-container").forEach((a=>{a.classList.add("hide-post-comp")})),document.querySelectorAll(".hexagon-tier-champ a").forEach((a=>{a.classList.remove("active")})),t.classList.remove("hide-post-comp"),e.classList.add("active");const c=apiNameAndIcon(a.items.mainItems),r=apiNameAndIcon(a.augments.mainAugs),d=Object.fromEntries(a.champions.mainChampions.map((a=>[a.apiName,[a.icon,a.cost,a.name,a.traits]])));renderPostComp(n.guides[s],d,c,r,o),requestAnimationFrame((()=>{scrollToPost(t,o)}))}window.addEventListener("DOMContentLoaded",(()=>{setTimeout((()=>{const a=JSON.parse(localStorage.getItem("postData")),n=JSON.parse(localStorage.getItem("guidesData"));a&&n&&handleHashURL(a,n)}),300)}));